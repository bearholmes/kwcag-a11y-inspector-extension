{"version":3,"file":"service-worker.js","names":["chrome","runtime","onInstalled","addListener","details","reason","console","log","tabs","create","url","catch","error","defaultSettings","monitors","resolutions","ccshow","linkmode","bgmode","linetype","colortype","bordersize","storage","sync","set","previousVersion","contextMenus","id","title","contexts","onClicked","info","tab","menuItemId","scripting","executeScript","target","tabId","files","insertCSS","message","includes","warn","action","startsWith","alert","onMessage","request","sender","sendResponse","cmd"],"sources":["../src/service-worker.js"],"sourcesContent":["/**\n * KWCAG A11y Inspector - Service Worker\n * Chrome Extension의 백그라운드 스크립트\n * @module service-worker\n */\n\n/**\n * 기본 설정 값\n * @typedef {Object} DefaultSettings\n * @property {string} monitors - 모니터 크기 (인치)\n * @property {string} resolutions - 화면 해상도\n * @property {string} ccshow - 색상 대비 표시 여부 (1: 표시, 0: 숨김)\n * @property {string} linkmode - 링크 모드 (1: 링크 요소만, 0: 모든 요소)\n * @property {string} bgmode - 배경 모드\n * @property {string} linetype - 테두리 스타일 (solid, dashed, dotted)\n * @property {string} colortype - 테두리 색상 (hex)\n * @property {string} bordersize - 테두리 두께 (px)\n */\n\n/**\n * 익스텐션 설치 또는 업데이트 시 발생하는 이벤트 처리\n * @listens chrome.runtime#onInstalled\n */\nchrome.runtime.onInstalled.addListener((details) => {\n  try {\n    // 익스텐션을 처음 설치한 경우\n    if (details.reason === 'install') {\n      console.log('[KWCAG Inspector] Extension installed');\n\n      // 옵션 페이지를 새 탭으로 열기\n      chrome.tabs.create({ url: 'option.html' }).catch((error) => {\n        console.error('[KWCAG Inspector] Failed to open options page:', error);\n      });\n\n      // 기본 설정 값 저장\n      /** @type {DefaultSettings} */\n      const defaultSettings = {\n        monitors: '17',\n        resolutions: '1366x768',\n        ccshow: '1',\n        linkmode: '0',\n        bgmode: '1',\n        linetype: 'dashed',\n        colortype: 'ff0000',\n        bordersize: '2',\n      };\n\n      chrome.storage.sync.set(defaultSettings).catch((error) => {\n        console.error(\n          '[KWCAG Inspector] Failed to save default settings:',\n          error\n        );\n      });\n    } else if (details.reason === 'update') {\n      console.log(\n        `[KWCAG Inspector] Extension updated from ${details.previousVersion}`\n      );\n    }\n  } catch (error) {\n    console.error('[KWCAG Inspector] Error in onInstalled listener:', error);\n  }\n});\n\n/**\n * 컨텍스트 메뉴 항목 생성\n * 우클릭 시 수동 계산기 팝업을 열 수 있는 메뉴 추가\n */\ntry {\n  chrome.contextMenus.create({\n    id: 'dkinspectContextMenu',\n    title: '수동계산 팝업 열기',\n    contexts: ['page', 'frame'],\n  });\n} catch (error) {\n  console.error('[KWCAG Inspector] Failed to create context menu:', error);\n}\n\n/**\n * 컨텍스트 메뉴 클릭 이벤트 처리\n * @listens chrome.contextMenus#onClicked\n * @param {chrome.contextMenus.OnClickData} info - 클릭 정보\n * @param {chrome.tabs.Tab} tab - 현재 탭 정보\n */\nchrome.contextMenus.onClicked.addListener(async (info, tab) => {\n  try {\n    // 수동계산 팝업 메뉴 클릭 시\n    if (info.menuItemId === 'dkinspectContextMenu') {\n      // 탭 ID 유효성 검사\n      if (!tab?.id) {\n        console.error('[KWCAG Inspector] Invalid tab ID');\n        return;\n      }\n\n      // cals.js 스크립트 주입\n      await chrome.scripting.executeScript({\n        target: { tabId: tab.id },\n        files: ['js/cals.js'],\n      });\n\n      // cals.css 스타일시트 주입\n      await chrome.scripting.insertCSS({\n        target: { tabId: tab.id },\n        files: ['css/cals.css'],\n      });\n\n      console.log('[KWCAG Inspector] Calculator popup injected');\n    }\n  } catch (error) {\n    console.error('[KWCAG Inspector] Error in context menu handler:', error);\n\n    // Chrome 내부 페이지 또는 권한 없는 페이지인 경우\n    if (error.message?.includes('Cannot access')) {\n      console.warn(\n        '[KWCAG Inspector] Cannot inject script on this page (restricted)'\n      );\n    }\n  }\n});\n\n/**\n * 확장 아이콘 클릭 이벤트 처리\n * 메인 인스펙터를 활성화/비활성화\n * @listens chrome.action#onClicked\n * @param {chrome.tabs.Tab} tab - 현재 탭 정보\n */\nchrome.action.onClicked.addListener(async (tab) => {\n  try {\n    // Chrome 내부 페이지 체크\n    if (tab.url?.startsWith('chrome://') || tab.url?.startsWith('edge://')) {\n      alert('Chrome/Edge 내부 페이지에서는 동작하지 않습니다.');\n      return;\n    }\n\n    // Chrome Web Store 페이지 체크\n    if (\n      tab.url?.includes('chrome.google.com/webstore') ||\n      tab.url?.includes('microsoftedge.microsoft.com/addons')\n    ) {\n      alert('스토어 페이지에서는 동작하지 않습니다.');\n      return;\n    }\n\n    // 탭 ID 유효성 검사\n    if (!tab?.id) {\n      console.error('[KWCAG Inspector] Invalid tab ID');\n      return;\n    }\n\n    // dkinspect.js 스크립트 주입\n    await chrome.scripting.executeScript({\n      target: { tabId: tab.id },\n      files: ['js/dkinspect.js'],\n    });\n\n    // dkinspect.css 스타일시트 주입\n    await chrome.scripting.insertCSS({\n      target: { tabId: tab.id },\n      files: ['css/dkinspect.css'],\n    });\n\n    console.log('[KWCAG Inspector] Inspector activated');\n  } catch (error) {\n    console.error('[KWCAG Inspector] Error in action click handler:', error);\n\n    // 사용자에게 친절한 에러 메시지 표시\n    if (error.message?.includes('Cannot access')) {\n      alert(\n        '이 페이지에서는 확장프로그램을 사용할 수 없습니다.\\n(권한이 제한된 페이지입니다)'\n      );\n    } else {\n      alert('확장프로그램 실행 중 오류가 발생했습니다.\\n콘솔을 확인해주세요.');\n    }\n  }\n});\n\n/**\n * 메시지 수신 이벤트 처리\n * Content Script와의 통신을 위한 메시지 리스너\n * @listens chrome.runtime#onMessage\n * @param {Object} request - 요청 메시지\n * @param {string} request.cmd - 명령어\n * @param {chrome.runtime.MessageSender} sender - 메시지 발신자\n * @param {Function} sendResponse - 응답 함수\n * @returns {boolean} true를 반환하면 비동기 응답 가능\n */\nchrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n  try {\n    // ESC 키 일시정지 명령 처리\n    if (request.cmd === 'pause') {\n      sendResponse('Escape');\n      return true;\n    }\n\n    // 알 수 없는 명령어\n    console.warn('[KWCAG Inspector] Unknown command:', request.cmd);\n    sendResponse({ error: 'Unknown command' });\n  } catch (error) {\n    console.error('[KWCAG Inspector] Error in message handler:', error);\n    sendResponse({ error: error.message });\n  }\n\n  return true; // 비동기 응답 지원\n});\n"],"mappings":"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","ignoreList":[]}